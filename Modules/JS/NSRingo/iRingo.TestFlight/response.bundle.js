console.log(" iRingo: ✈ TestFlight"),console.log("response.bundle.js"),console.log("Version: 3.4.0"),console.log("Date: 2024/12/24 16:53:50"),(()=>{"use strict";var e={},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,s),r.exports}s.rv=function(){return"1.1.8"},s.ruid="bundler=rspack@1.1.8";let a=(()=>{let e=Object.keys(globalThis);switch(!0){case e.includes("$task"):return"Quantumult X";case e.includes("$loon"):return"Loon";case e.includes("$rocket"):return"Shadowrocket";case"undefined"!=typeof module:return"Node.js";case e.includes("Egern"):return"Egern";case e.includes("$environment"):if($environment["surge-version"])return"Surge";if($environment["stash-version"])return"Stash";return;default:return}})();class i{static #e=new Map([]);static #t=[];static #s=new Map([]);static clear=()=>{};static count=(e="default")=>{switch(i.#e.has(e)){case!0:i.#e.set(e,i.#e.get(e)+1);break;case!1:i.#e.set(e,0)}i.log(`${e}: ${i.#e.get(e)}`)};static countReset=(e="default")=>{switch(i.#e.has(e)){case!0:i.#e.set(e,0),i.log(`${e}: ${i.#e.get(e)}`);break;case!1:i.warn(`Counter "${e}" doesn’t exist`)}};static debug=(...e)=>{!(i.#a<4)&&(e=e.map(e=>`🅱️ ${e}`),i.log(...e))};static error(...e){if(!(i.#a<1)){switch(a){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Quantumult X":default:e=e.map(e=>`❌ ${e}`);break;case"Node.js":e=e.map(e=>`❌ ${e.stack}`)}i.log(...e)}}static exception=(...e)=>i.error(...e);static group=e=>i.#t.unshift(e);static groupEnd=()=>i.#t.shift();static info(...e){!(i.#a<3)&&(e=e.map(e=>`ℹ️ ${e}`),i.log(...e))}static #a=3;static get logLevel(){switch(i.#a){case 0:return"OFF";case 1:return"ERROR";case 2:return"WARN";case 3:default:return"INFO";case 4:return"DEBUG";case 5:return"ALL"}}static set logLevel(e){switch(typeof e){case"string":e=e.toLowerCase();break;case"number":break;default:e="warn"}switch(e){case 0:case"off":i.#a=0;break;case 1:case"error":i.#a=1;break;case 2:case"warn":case"warning":default:i.#a=2;break;case 3:case"info":i.#a=3;break;case 4:case"debug":i.#a=4;break;case 5:case"all":i.#a=5}}static log=(...e)=>{0!==i.#a&&(e=e.map(e=>{switch(typeof e){case"object":e=JSON.stringify(e);break;case"bigint":case"number":case"boolean":case"string":e=e.toString()}return e}),i.#t.forEach(t=>{(e=e.map(e=>`  ${e}`)).unshift(`▼ ${t}:`)}),console.log((e=["",...e]).join("\n")))};static time=(e="default")=>i.#s.set(e,Date.now());static timeEnd=(e="default")=>i.#s.delete(e);static timeLog=(e="default")=>{let t=i.#s.get(e);t?i.log(`${e}: ${Date.now()-t}ms`):i.warn(`Timer "${e}" doesn’t exist`)};static warn(...e){!(i.#a<2)&&(e=e.map(e=>`⚠️ ${e}`),i.log(...e))}}class r{static escape(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,e=>t[e])}static get(e={},t="",s){!Array.isArray(t)&&(t=r.toPath(t));let a=t.reduce((e,t)=>Object(e)[t],e);return void 0===a?s:a}static omit(e={},t=[]){return!Array.isArray(t)&&(t=[t.toString()]),t.forEach(t=>r.unset(e,t)),e}static pick(e={},t=[]){return!Array.isArray(t)&&(t=[t.toString()]),Object.fromEntries(Object.entries(e).filter(([e,s])=>t.includes(e)))}static set(e,t,s){return!Array.isArray(t)&&(t=r.toPath(t)),t.slice(0,-1).reduce((e,s,a)=>Object(e[s])===e[s]?e[s]:e[s]=/^\d+$/.test(t[a+1])?[]:{},e)[t[t.length-1]]=s,e}static toPath(e){return e.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean)}static unescape(e){let t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#39;/g,e=>t[e])}static unset(e={},t=""){return!Array.isArray(t)&&(t=r.toPath(t)),t.reduce((e,s,a)=>a===t.length-1?(delete e[s],!0):Object(e)[s],e)}}let o={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",304:"Not Modified",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Content Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"},n=e=>{let t={};switch(typeof e){case void 0:break;case"string":case"number":case"boolean":switch($app){case"Surge":case"Stash":case"Egern":default:t.url=e;break;case"Loon":case"Shadowrocket":t.openUrl=e;break;case"Quantumult X":t["open-url"]=e;case"Node.js":}break;case"object":{let s=e.open||e["open-url"]||e.url||e.openUrl,a=e.copy||e["update-pasteboard"]||e.updatePasteboard,i=e.media||e["media-url"]||e.mediaUrl;switch($app){case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:if(s&&(t.action="open-url",t.url=s),a&&(t.action="clipboard",t.text=a),i)switch(!0){case i.startsWith("http"):t["media-url"]=i;break;case i.startsWith("data:"):{let{MIME:s,Base64:a}=i.match(/^data:(?<MIME>\w+\/\w+);base64,(?<Base64>.+)/).groups;t["media-base64"]=a,t["media-base64-mime"]=e.mime||s;break}default:switch(t["media-base64"]=i,!0){case i.startsWith("CiVQREYt"):case i.startsWith("JVBERi0"):t["media-base64-mime"]="application/pdf";break;case i.startsWith("R0lGODdh"):case i.startsWith("R0lGODlh"):t["media-base64-mime"]="image/gif";break;case i.startsWith("iVBORw0KGgo"):t["media-base64-mime"]="image/png";break;case i.startsWith("/9j/"):t["media-base64-mime"]="image/jpg";break;case i.startsWith("Qk02U"):t["media-base64-mime"]="image/bmp"}}e["auto-dismiss"]&&(t["auto-dismiss"]=e["auto-dismiss"]),e.sound&&(t.sound=e.sound);break;case"Loon":s&&(t.openUrl=s),i?.startsWith("http")&&(t.mediaUrl=i);break;case"Quantumult X":s&&(t["open-url"]=s),i?.startsWith("http")&&(t["media-url"]=i),a&&(t["update-pasteboard"]=a);case"Node.js":}break}default:Console.error(`不支持的通知参数类型: ${typeof e}`,"")}return t};class c{static data=null;static dataFile="box.dat";static #i=/^@(?<key>[^.]+)(?:\.(?<path>.*))?$/;static getItem(e,t=null){let s=t;if(!0===e.startsWith("@")){let{key:t,path:a}=e.match(c.#i)?.groups;e=t;let i=c.getItem(e,{});"object"!=typeof i&&(i={}),s=r.get(i,a);try{s=JSON.parse(s)}catch(e){}}else{switch(a){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":s=$persistentStore.read(e);break;case"Quantumult X":s=$prefs.valueForKey(e);break;case"Node.js":c.data=c.#r(c.dataFile),s=c.data?.[e];break;default:s=c.data?.[e]||null}try{s=JSON.parse(s)}catch(e){}}return s??t}static setItem(e=new String,t=new String){let s=!1;if("object"==typeof t)t=JSON.stringify(t);else t=String(t);if(!0===e.startsWith("@")){let{key:a,path:i}=e.match(c.#i)?.groups;e=a;let o=c.getItem(e,{});"object"!=typeof o&&(o={}),r.set(o,i,t),s=c.setItem(e,o)}else switch(a){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":s=$persistentStore.write(t,e);break;case"Quantumult X":s=$prefs.setValueForKey(t,e);break;case"Node.js":c.data=c.#r(c.dataFile),c.data[e]=t,c.#o(c.dataFile),s=!0;break;default:s=c.data?.[e]||null}return s}static removeItem(e){let t=!1;if(!0===e.startsWith("@")){let{key:s,path:a}=e.match(c.#i)?.groups;e=s;let i=c.getItem(e);"object"!=typeof i&&(i={}),keyValue=r.unset(i,a),t=c.setItem(e,i)}else switch(a){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":t=!1;break;case"Quantumult X":t=$prefs.removeValueForKey(e);break;default:t=!1}return t}static clear(){let e=!1;switch(a){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":e=!1;break;case"Quantumult X":e=$prefs.removeAllValues();break;default:e=!1}return e}static #r=e=>{if("Node.js"!==a)return{};{this.fs=this.fs?this.fs:require("node:fs"),this.path=this.path?this.path:require("node:path");let t=this.path.resolve(e),s=this.path.resolve(process.cwd(),e),a=this.fs.existsSync(t),i=!a&&this.fs.existsSync(s);if(!a&&!i)return{};try{return JSON.parse(this.fs.readFileSync(a?t:s))}catch(e){return{}}}};static #o=(e=this.dataFile)=>{if("Node.js"===a){this.fs=this.fs?this.fs:require("node:fs"),this.path=this.path?this.path:require("node:path");let t=this.path.resolve(e),s=this.path.resolve(process.cwd(),e),a=this.fs.existsSync(t),i=!a&&this.fs.existsSync(s),r=JSON.stringify(this.data);a?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(s,r):this.fs.writeFileSync(t,r)}}}function l(e){return/^\d+$/.test(e)&&(e=Number.parseInt(e,10)),e}class u{constructor(e){switch(typeof e){case"string":if(0===e.length)break;e.startsWith("?")&&(e=e.slice(1)),e.split("&").map(e=>e.split("=")).forEach(([e,t])=>{this.#n.push(e?decodeURIComponent(e):e),this.#c.push(t?decodeURIComponent(t):t)});break;case"object":if(Array.isArray(e))Object.entries(e).forEach(([e,t])=>{this.#n.push(e?decodeURIComponent(e):e),this.#c.push(t?decodeURIComponent(t):t)});else if(Symbol.iterator in Object(e))for(let[t,s]of e)this.#n.push(t?decodeURIComponent(t):t),this.#c.push(s?decodeURIComponent(s):s)}this.#l(this.#n,this.#c)}#u="";#n=[];#c=[];#l(e,t){0===e.length?this.#u="":this.#u=e.map((e,s)=>{switch(typeof t[s]){case"object":return`${encodeURIComponent(e)}=${encodeURIComponent(JSON.stringify(t[s]))}`;case"boolean":case"number":case"string":return`${encodeURIComponent(e)}=${encodeURIComponent(t[s])}`;default:return encodeURIComponent(e)}}).join("&")}append(e,t){e=decodeURIComponent(e),t&&(t=decodeURIComponent(t)),this.#n.push(e),this.#c.push(t),this.#l(this.#n,this.#c)}delete(e,t){for(e=decodeURIComponent(e),t&&(t=decodeURIComponent(t));this.#n.indexOf(e)>-1;)this.#c.splice(this.#n.indexOf(e),1),this.#n.splice(this.#n.indexOf(e),1);this.#l(this.#n,this.#c)}entries(){return this.#n.map((e,t)=>[e,this.#c[t]])}get(e){return e=decodeURIComponent(e),this.#c[this.#n.indexOf(e)]}getAll(e){return e=decodeURIComponent(e),this.#c.filter((t,s)=>this.#n[s]===e)}has(e,t){return e=decodeURIComponent(e),t&&(t=decodeURIComponent(t)),this.#n.indexOf(e)>-1}keys(){return this.#n}set(e,t){if(e=decodeURIComponent(e),t&&(t=decodeURIComponent(t)),-1===this.#n.indexOf(e))this.append(e,t);else{let s=!0,a=[];this.#n=this.#n.filter((i,r)=>i!==e?(a.push(this.#c[r]),!0):!!s&&(s=!1,a.push(t),!0)),this.#c=a,this.#l(this.#n,this.#c)}}sort(){let e=this.entries().sort();this.#n=[],this.#c=[],e.forEach(e=>{this.#n.push(e[0]),this.#c.push(e[1])}),this.#l(this.#n,this.#c)}toString=()=>this.#u;values=()=>this.#c.values()}class h{constructor(e,t){switch(typeof e){case"string":{let s=/^(blob:|file:)?[a-zA-z]+:\/\/.*/.test(e),a=!!t&&/^(blob:|file:)?[a-zA-z]+:\/\/.*/.test(t);if(s)this.href=e;else if(a)this.href=t+e;else throw TypeError('URL string is not valid. If using a relative url, a second argument needs to be passed representing the base URL. Example: new URL("relative/path", "http://www.example.com");');break}case"object":break;default:throw TypeError("Invalid argument type.")}}#h={hash:"",host:"",hostname:"",href:"",password:"",pathname:"",port:Number.NaN,protocol:"",search:"",searchParams:new u(""),username:""};static #p=/^(?<scheme>([^:\/?#]+):)?(?:\/\/(?<authority>[^\/?#]*))?(?<path>[^?#]*)(?<query>\?([^#]*))?(?<hash>#(.*))?$/;static #d=/^(?<authentication>(?<username>[^:]*)(:(?<password>[^@]*))?@)?(?<hostname>[^:]+)(:(?<port>\d+))?$/;get hash(){return this.#h.hash}set hash(e){0!==e.length&&(e.startsWith("#")&&(e=e.slice(1)),this.#h.hash=`#${encodeURIComponent(e)}`)}get host(){return this.port.length>0?`${this.hostname}:${this.port}`:this.hostname}set host(e){[this.hostname,this.port]=e.split(":",2)}get hostname(){return encodeURIComponent(this.#h.hostname)}set hostname(e){this.#h.hostname=e??""}get href(){let e="";return this.username.length>0&&(e+=this.username,this.password.length>0&&(e+=`:${this.password}`),e+="@"),`${this.protocol}//${e}${this.host}${this.pathname}${this.search}${this.hash}`}set href(e){(e.startsWith("blob:")||e.startsWith("file:"))&&(e=e.slice(5));let t=e.match(h.#p);if(!t)throw TypeError("Invalid URL format.");this.protocol=t.groups.scheme??"";let s=t.groups.authority.match(h.#d);this.username=s.groups.username??"",this.password=s.groups.password??"",this.hostname=s.groups.hostname??"",this.port=s.groups.port??"",this.pathname=t.groups.path??"",this.search=t.groups.query??"",this.hash=t.groups.hash??""}get origin(){return`${this.protocol}//${this.host}`}get password(){return encodeURIComponent(this.#h.password)}set password(e){this.username.length>0&&(this.#h.password=e??"")}get pathname(){return`/${this.#h.pathname}`}set pathname(e){(e=`${e}`).startsWith("/")&&(e=e.slice(1)),this.#h.pathname=e}get port(){if(Number.isNaN(this.#h.port))return"";let e=this.#h.port.toString();return"ftp:"===this.protocol&&"21"===e||"http:"===this.protocol&&"80"===e||"https:"===this.protocol&&"443"===e?"":e}set port(e){if(""===e)this.#h.port=Number.NaN;else{let t=Number.parseInt(e,10);t>=0&&t<65535&&(this.#h.port=t)}}get protocol(){return`${this.#h.protocol}:`}set protocol(e){e.endsWith(":")&&(e=e.slice(0,-1)),this.#h.protocol=e}get search(){return(this.#h.search=this.searchParams.toString(),this.#h.search.length>0)?`?${this.#h.search}`:""}set search(e){(e=`${e}`).startsWith("?")&&(e=e.slice(1)),this.#h.search=e,this.#h.searchParams=new u(this.#h.search)}get searchParams(){return this.#h.searchParams}get username(){return encodeURIComponent(this.#h.username)}set username(e){this.#h.username=e??""}static parse=(e,t)=>new h(e,t);toString=()=>this.href;toJSON=()=>JSON.stringify({hash:this.hash,host:this.host,hostname:this.hostname,href:this.href,origin:this.origin,password:this.password,pathname:this.pathname,port:this.port,protocol:this.protocol,search:this.search,searchParams:this.searchParams,username:this.username})}let p={Testflight:{Settings:{CountryCode:"US",MultiAccount:!1,Universal:!0,AlwaysShowInstall:!1,MergeNotifications:!1}},Default:{Settings:{LogLevel:"WARN"},Configs:{Storefront:{AE:"143481",AF:"143610",AG:"143540",AI:"143538",AL:"143575",AM:"143524",AO:"143564",AR:"143505",AT:"143445",AU:"143460",AZ:"143568",BA:"143612",BB:"143541",BD:"143490",BE:"143446",BF:"143578",BG:"143526",BH:"143559",BJ:"143576",BM:"143542",BN:"143560",BO:"143556",BR:"143503",BS:"143539",BT:"143577",BW:"143525",BY:"143565",BZ:"143555",CA:"143455",CD:"143613",CG:"143582",CH:"143459",CI:"143527",CL:"143483",CM:"143574",CN:"143465",CO:"143501",CR:"143495",CV:"143580",CY:"143557",CZ:"143489",DE:"143443",DK:"143458",DM:"143545",DO:"143508",DZ:"143563",EC:"143509",EE:"143518",EG:"143516",ES:"143454",FI:"143447",FJ:"143583",FM:"143591",FR:"143442",GA:"143614",GB:"143444",GD:"143546",GF:"143615",GH:"143573",GM:"143584",GR:"143448",GT:"143504",GW:"143585",GY:"143553",HK:"143463",HN:"143510",HR:"143494",HU:"143482",ID:"143476",IE:"143449",IL:"143491",IN:"143467",IQ:"143617",IS:"143558",IT:"143450",JM:"143511",JO:"143528",JP:"143462",KE:"143529",KG:"143586",KH:"143579",KN:"143548",KP:"143466",KR:"143466",KW:"143493",KY:"143544",KZ:"143517",TC:"143552",TD:"143581",TJ:"143603",TH:"143475",TM:"143604",TN:"143536",TO:"143608",TR:"143480",TT:"143551",TW:"143470",TZ:"143572",LA:"143587",LB:"143497",LC:"143549",LI:"143522",LK:"143486",LR:"143588",LT:"143520",LU:"143451",LV:"143519",LY:"143567",MA:"143620",MD:"143523",ME:"143619",MG:"143531",MK:"143530",ML:"143532",MM:"143570",MN:"143592",MO:"143515",MR:"143590",MS:"143547",MT:"143521",MU:"143533",MV:"143488",MW:"143589",MX:"143468",MY:"143473",MZ:"143593",NA:"143594",NE:"143534",NG:"143561",NI:"143512",NL:"143452",NO:"143457",NP:"143484",NR:"143606",NZ:"143461",OM:"143562",PA:"143485",PE:"143507",PG:"143597",PH:"143474",PK:"143477",PL:"143478",PT:"143453",PW:"143595",PY:"143513",QA:"143498",RO:"143487",RS:"143500",RU:"143469",RW:"143621",SA:"143479",SB:"143601",SC:"143599",SE:"143456",SG:"143464",SI:"143499",SK:"143496",SL:"143600",SN:"143535",SR:"143554",ST:"143598",SV:"143506",SZ:"143602",UA:"143492",UG:"143537",US:"143441",UY:"143514",UZ:"143566",VC:"143550",VE:"143502",VG:"143543",VN:"143471",VU:"143609",XK:"143624",YE:"143571",ZA:"143472",ZM:"143622",ZW:"143605"}}}},d=new h($request.url);i.info(`url: ${d.toJSON()}`);let m=d.pathname.split("/").filter(Boolean);i.info(`PATHs: ${m}`);let g=($response.headers?.["Content-Type"]??$response.headers?.["content-type"])?.split(";")?.[0];function f(e){switch(i.debug(e.platform||e.name),e.platform||e.name){case"ios":e=t(e);break;case"osx":e?.macBuildCompatibility?.runsOnAppleSilicon===!0&&(i.debug("runsOnAppleSilicon"),e=t(e))}return e;function t(e){return e.compatible=!0,e.platformCompatible=!0,e.hardwareCompatible=!0,e.osCompatible=!0,e?.permission&&(e.permission="install"),e?.deviceFamilyInfo&&(e.deviceFamilyInfo=[{number:1,name:"iOS",iconUrl:"https://itunesconnect-mr.itunes.apple.com/itc/img/device-icons/device_family_icon_1.png"},{number:2,name:"iPad",iconUrl:"https://itunesconnect-mr.itunes.apple.com/itc/img/device-icons/device_family_icon_2.png"},{number:3,name:"Apple TV",iconUrl:"https://itunesconnect-mr.itunes.apple.com/itc/img/device-icons/device_family_icon_3.png"}]),e?.compatibilityData?.compatibleDeviceFamilies&&(e.compatibilityData.compatibleDeviceFamilies=[{name:"iPad",minimumSupportedDevice:null,unsupportedDevices:[]},{name:"iPhone",minimumSupportedDevice:null,unsupportedDevices:[]},{name:"iPod",minimumSupportedDevice:null,unsupportedDevices:[]},{name:"Mac",minimumSupportedDevice:null,unsupportedDevices:[]}]),e.macBuildCompatibility&&(e.macBuildCompatibility.runsOnIntel=!0,e.macBuildCompatibility.runsOnAppleSilicon=!0),e}}i.info(`FORMAT: ${g}`),(async()=>{let{Settings:e,Caches:t,Configs:s}=function(e,t,s){i.log("☑️ Set Environment Variables");let{Settings:a,Caches:o,Configs:n}=function(e,t,s){t=[t].flat(Number.POSITIVE_INFINITY);let a={Settings:s?.Default?.Settings||{},Configs:s?.Default?.Configs||{},Caches:{}};switch(t.forEach(e=>{a.Settings={...a.Settings,...s?.[e]?.Settings},a.Configs={...a.Configs,...s?.[e]?.Configs}}),typeof $argument){case"string":$argument=Object.fromEntries($argument.split("&").map(e=>e.split("=",2).map(e=>e.replace(/\"/g,""))));case"object":{let e={};Object.keys($argument).forEach(t=>r.set(e,t,$argument[t])),a.Settings={...a.Settings,...e}}}let i=c.getItem(e);return i&&t.forEach(e=>{switch(typeof i?.[e]?.Settings){case"string":i[e].Settings=JSON.parse(i[e].Settings||"{}");case"object":a.Settings={...a.Settings,...i[e].Settings}}switch(typeof i?.[e]?.Caches){case"string":i[e].Caches=JSON.parse(i[e].Caches||"{}");case"object":a.Caches={...a.Caches,...i[e].Caches}}}),function e(t,s){for(let a in t){let i=t[a];t[a]="object"==typeof i&&null!==i?e(i,s):s(a,i)}return t}(a.Settings,(e,t)=>("true"===t||"false"===t?t=JSON.parse(t):"string"==typeof t&&(t=t.includes(",")?t.split(",").map(e=>l(e)):l(t)),t)),a}(e,t,s);if(i.info(`typeof Settings: ${typeof a}`,`Settings: ${JSON.stringify(a,null,2)}`),n.Locale&&(n.Locale=new Map(n.Locale)),n.i18n)for(let e in n.i18n)n.i18n[e]=new Map(n.i18n[e]);return i.log("✅ Set Environment Variables"),{Settings:a,Caches:o,Configs:n}}("iRingo","TestFlight",p);i.logLevel=e.LogLevel;let a={};switch(g){case void 0:case"application/x-www-form-urlencoded":case"text/plain":default:case"application/x-mpegURL":case"application/x-mpegurl":case"application/vnd.apple.mpegurl":case"audio/mpegurl":case"text/xml":case"text/html":case"text/plist":case"application/xml":case"application/plist":case"application/x-plist":case"text/vtt":case"application/vtt":break;case"text/json":case"application/json":if(a=JSON.parse($response.body??"{}"),"testflight.apple.com"===d.hostname)switch(d.pathname){case"/v1/session/authenticate":if(!0===e.MultiAccount){i.info("启用多账号支持");let e=$request?.headers?.["X-Request-Id"]??$request?.headers?.["x-request-id"],s=$request?.headers?.["X-Session-Id"]??$request?.headers?.["x-session-id"],r=$request?.headers?.["X-Session-Digest"]??$request?.headers?.["x-session-digest"];t?.data?(i.info("有Caches.data"),a?.data?.accountId===t?.data?.accountId&&(i.info("Account ID相等，刷新缓存"),t.headers={"X-Request-Id":e,"X-Session-Id":s,"X-Session-Digest":r},t.data=a.data,t.data.termsAndConditions=null,t.data.hasNewTermsAndConditions=!1,c.setItem("@iRingo.TestFlight.Caches",t))):(i.debug("Caches空，写入"),t.headers={"X-Request-Id":e,"X-Session-Id":s,"X-Session-Digest":r},t.data=a.data,t.data.termsAndConditions=null,t.data.hasNewTermsAndConditions=!1,c.setItem("@iRingo.TestFlight.Caches",t))}break;case"/v1/devices":case"/v1/devices/apns":case"/v1/devices/add":case"/v1/devices/remove":break;default:switch(m[0]){case"v1":case"v2":case"v3":switch(m[1]){case"accounts":switch(m[2]){case"settings":switch(m[3]){case void 0:break;case"notifications":m[4]}break;case t?.data?.accountId:default:switch(m[3]){case void 0:break;case"apps":if(void 0===m[4])switch(e.Universal){case!0:default:i.info("启用通用应用支持"),null===a.error&&(i.debug("数据无错误"),a.data=a.data.map(e=>(!1!==e.previouslyTested&&(i.debug("不是前测试人员"),e.platforms=e.platforms.map(e=>(e.build=f(e.build),e))),e)));break;case!1:i.info("启用通用应用支持")}else switch(m[5]){case void 0:break;case"builds":if(void 0===m[7])switch(e.Universal){case!0:default:i.info("启用通用应用支持"),null===a.error&&(i.debug("数据无错误"),a.data.currentBuild=f(a.data.currentBuild),a.data.builds=a.data.builds.map(e=>f(e)));break;case!1:i.info("关闭通用应用支持")}break;case"platforms":m[6];switch(m[7]){case void 0:break;case"trains":switch(m[9]){case void 0:break;case"builds":if(void 0===m[10])switch(e.Universal){case!0:default:i.info("启用通用应用支持"),null===a.error&&(i.debug("数据无错误"),a.data=a.data.map(e=>f(e)));break;case!1:i.info("关闭通用应用支持")}}}}break;case"ru":if(!0===e.AlwaysShowInstall)switch(i.info("总是显示安装选项"),a.data?.status){case"OPEN":break;case"FULL":a.data.status="OPEN",a.data.app.eligibility={status:"NO_CRITERIA",criteria:null}}else i.info("不显示安装选项")}}break;case"apps":if("install"===m[3])m[4];break;case"messages":m[2],t?.data?.accountId;m[3]}}}$response.body=JSON.stringify(a);case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":case"application/grpc":case"application/grpc+proto":case"application/octet-stream":}})().catch(e=>i.error(e)).finally(()=>(function(e={}){switch(a){case"Surge":e.policy&&r.set(e,"headers.X-Surge-Policy",e.policy),i.log("\uD83D\uDEA9 执行结束!",`🕛 ${new Date().getTime()/1e3-$script.startTime} 秒`),$done(e);break;case"Loon":e.policy&&(e.node=e.policy),i.log("\uD83D\uDEA9 执行结束!",`🕛 ${(new Date-$script.startTime)/1e3} 秒`),$done(e);break;case"Stash":e.policy&&r.set(e,"headers.X-Stash-Selected-Proxy",encodeURI(e.policy)),i.log("\uD83D\uDEA9 执行结束!",`🕛 ${(new Date-$script.startTime)/1e3} 秒`),$done(e);break;case"Egern":case"Shadowrocket":i.log("\uD83D\uDEA9 执行结束!"),$done(e);break;case"Quantumult X":switch(e.policy&&r.set(e,"opts.policy",e.policy),typeof(e=r.pick(e,["status","url","headers","body","bodyBytes"])).status){case"number":e.status=`HTTP/1.1 ${e.status} ${o[e.status]}`;break;case"string":case"undefined":break;default:throw TypeError(`${Function.name}: 参数类型错误, status 必须为数字或字符串`)}e.body instanceof ArrayBuffer?(e.bodyBytes=e.body,e.body=void 0):ArrayBuffer.isView(e.body)?(e.bodyBytes=e.body.buffer.slice(e.body.byteOffset,e.body.byteLength+e.body.byteOffset),e.body=void 0):e.body&&(e.bodyBytes=void 0),i.log("\uD83D\uDEA9 执行结束!"),$done(e);break;default:i.log("\uD83D\uDEA9 执行结束!"),process.exit(1)}})($response))})();